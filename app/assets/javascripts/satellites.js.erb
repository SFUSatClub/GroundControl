$(document).ready(function() {
  var table = $('.satellites-table').DataTable();
  genLongLats();


  function genLongLats(){
    $(".satellites-table > tbody > tr").each(function(index, item)
    {
      var tleLine1 = $(item).find(".satellite-tle1").text();
      var tleLine2 = $(item).find(".satellite-tle2").text();

      if (tleLine1.length != 0 && tleLine2.length != 0)
      {

        // Initialize a satellite record
        var satrec = satellite.twoline2satrec(tleLine1, tleLine2);

        //  Or you can use a JavaScript Date
        var positionAndVelocity = satellite.propagate(satrec, new Date());

        // The position_velocity result is a key-value pair of ECI coordinates.
        // These are the base results from which all other coordinates are derived.
        var positionEci = positionAndVelocity.position,
        velocityEci = positionAndVelocity.velocity;

        // You will need GMST for some of the coordinate transforms.
        // http://en.wikipedia.org/wiki/Sidereal_time#Definition
        var gmst = satellite.gstimeFromDate(new Date());

        var positionGd   = satellite.eciToGeodetic(positionEci, gmst);

        var longitude = positionGd.longitude;
        var latitude  = positionGd.latitude;

        var longitudeStr = satellite.degreesLong(longitude),
        latitudeStr  = satellite.degreesLat(latitude);

        $(item).find('.sat-longitude').text(longitudeStr);
        $(item).find('.sat-latitude').text(latitudeStr);
      }
    });
  }

  $(".satellites-table").ready( function(){
    genLongLats();
  });

  $(".satellites-table").on('draw.dt', function () {
    genLongLats();
  });

  var regenLongLat = setInterval(genLongLats,1000);

  $(".edit_user").on('submit', function(e){
    var $form = $(this);

     // Iterate over all checkboxes in the table
     table.$('input[type="checkbox"]').each(function(){
      // If checkbox doesn't exist in DOM
      if(!$.contains(document, this)){
         // If checkbox is checked
         if(this.checked){
            // Create a hidden element
            $form.append(
             $('<input>')
             .attr('type', 'hidden')
             .attr('name', this.name)
             .val(this.value)
             );
          }
        }
      });
   });


})
