$(document).ready(function() {
  var map = WE.map('earth_div', {
            center: [51.505, -0.09],
            zoom: 4,
            dragging: true,
            scrollWheelZoom: true,
            proxyHost: 'http://srtm.webglearth.com/cgi-bin/corsproxy.fcgi?url='
          });

          //Add baselayer
          WE.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
            attribution: 'Â© OpenStreetMap contributors'
          }).addTo(map);
  var marker = WE.marker([51.5, -0.1]).addTo(map);
  marker.bindPopup('<b>Hello world!</b>');
  var i = 0;
  $(".satellites-table > tbody > tr").each(function(index, item)
  {
    var tleLine1 = $(item).find(".satellite-tle1").text();
    var tleLine2 = $(item).find(".satellite-tle2").text();
    console.log(tleLine1);

    if (tleLine1.length != 0 && tleLine2.length != 0)
    {
      // Initialize a satellite record
      var satrec = satellite.twoline2satrec(tleLine1, tleLine2);

      //  Or you can use a JavaScript Date
      var positionAndVelocity = satellite.propagate(satrec, new Date());

      // The position_velocity result is a key-value pair of ECI coordinates.
      // These are the base results from which all other coordinates are derived.
      var positionEci = positionAndVelocity.position,
      velocityEci = positionAndVelocity.velocity;

      // You will need GMST for some of the coordinate transforms.
      // http://en.wikipedia.org/wiki/Sidereal_time#Definition
      var gmst = satellite.gstimeFromDate(new Date());

      var positionGd   = satellite.eciToGeodetic(positionEci, gmst);

      var longitude = positionGd.longitude;
      var latitude  = positionGd.latitude;
      
      $(item).find('.sat-longitude').text(longitude);
      $(item).find('.sat-latitude').text(latitude);

		var name = $(item).find(".satellite-name").text();
		var marker = WE.marker([latitude, longitude]).addTo(map);
		marker.bindPopup(name);
		i++;
		if (i == 2) {
			// Equivalent to a break statement in the context of ".each"
			return false;
		}
	}
  });
});
